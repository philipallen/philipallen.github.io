import{r as s}from"./index-KmaxkdDD.js";import{n as j}from"./useFocusRing-ByLANK_J.js";import{j as R,d as y,o as D,c as T}from"./utils-gyFJKyBV.js";import{c as U}from"./Label-D5Kag7W1.js";const h={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},B={...h,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:h,validationErrors:[]},F=s.createContext({}),C="__formValidationState"+Date.now();function X(t){if(t[C]){let{realtimeValidation:e,displayValidation:a,updateValidation:i,resetValidation:c,commitValidation:r}=t[C];return{realtimeValidation:e,displayValidation:a,updateValidation:i,resetValidation:c,commitValidation:r}}return Q(t)}function Q(t){let{isInvalid:e,validationState:a,name:i,value:c,builtinValidation:r,validate:o,validationBehavior:n="aria"}=t;a&&(e||(e=a==="invalid"));let l=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:B}:null,v=s.useMemo(()=>{if(!o||c==null)return null;let d=k(o,c);return L(d)},[o,c]);r!=null&&r.validationDetails.valid&&(r=void 0);let u=s.useContext(F),f=s.useMemo(()=>i?Array.isArray(i)?i.flatMap(d=>M(u[d])):M(u[i]):[],[u,i]),[P,w]=s.useState(u),[x,b]=s.useState(!1);u!==P&&(w(u),b(!1));let p=s.useMemo(()=>L(x?[]:f),[x,f]),S=s.useRef($),[V,E]=s.useState($),m=s.useRef($),A=()=>{if(!O)return;g(!1);let d=v||r||S.current;I(d,m.current)||(m.current=d,E(d))},[O,g]=s.useState(!1);return s.useEffect(A),{realtimeValidation:l||p||v||r||$,displayValidation:n==="native"?l||p||V:l||p||v||r||V,updateValidation(d){n==="aria"&&!I(V,d)?E(d):S.current=d},resetValidation(){let d=$;I(d,m.current)||(m.current=d,E(d)),n==="native"&&g(!1),b(!0)},commitValidation(){n==="native"&&g(!0),b(!0)}}}function M(t){return t?Array.isArray(t)?t:[t]:[]}function k(t,e){if(typeof t=="function"){let a=t(e);if(a&&typeof a!="boolean")return M(a)}return[]}function L(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:B}:null}function I(t,e){return t===e?!0:!!t&&!!e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every((a,i)=>a===e.validationErrors[i])&&Object.entries(t.validationDetails).every(([a,i])=>e.validationDetails[a]===i)}function Z(...t){let e=new Set,a=!1,i={...h};for(let o of t){var c,r;for(let n of o.validationErrors)e.add(n);a||(a=o.isInvalid);for(let n in i)(c=i)[r=n]||(c[r]=o.validationDetails[n])}return i.valid=!a,{isInvalid:a,validationErrors:[...e],validationDetails:i}}function _(t,e,a){let{validationBehavior:i,focus:c}=t;R(()=>{if(i==="native"&&(a!=null&&a.current)&&!a.current.disabled){let l=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";a.current.setCustomValidity(l),a.current.hasAttribute("title")||(a.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(N(a.current))}});let r=y(()=>{e.resetValidation()}),o=y(l=>{var v;e.displayValidation.isInvalid||e.commitValidation();let u=a==null||(v=a.current)===null||v===void 0?void 0:v.form;if(!l.defaultPrevented&&a&&u&&Y(u)===a.current){var f;c?c():(f=a.current)===null||f===void 0||f.focus(),j("keyboard")}l.preventDefault()}),n=y(()=>{e.commitValidation()});s.useEffect(()=>{let l=a==null?void 0:a.current;if(!l)return;let v=l.form;return l.addEventListener("invalid",o),l.addEventListener("change",n),v==null||v.addEventListener("reset",r),()=>{l.removeEventListener("invalid",o),l.removeEventListener("change",n),v==null||v.removeEventListener("reset",r)}},[a,o,n,r,i])}function q(t){let e=t.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function N(t){return{isInvalid:!t.validity.valid,validationDetails:q(t),validationErrors:t.validationMessage?[t.validationMessage]:[]}}function Y(t){for(let e=0;e<t.elements.length;e++){let a=t.elements[e];if(!a.validity.valid)return a}return null}function ee(t){let{description:e,errorMessage:a,isInvalid:i,validationState:c}=t,{labelProps:r,fieldProps:o}=U(t),n=D([!!e,!!a,i,c]),l=D([!!e,!!a,i,c]);return o=T(o,{"aria-describedby":[n,l,t["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:r,fieldProps:o,descriptionProps:{id:n},errorMessageProps:{id:l}}}const ae=s.createContext(null),te=s.createContext(null);export{X as $,ee as a,_ as b,te as c,ae as d,C as e,$ as f,Z as g};
