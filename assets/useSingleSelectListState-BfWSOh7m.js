import{a as m,b as p,c as x}from"./Collection-EYIO8LIo.js";import{r as v}from"./index-KmaxkdDD.js";import{$ as S}from"./useControlledState-BCPvzKxG.js";class k{*[Symbol.iterator](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(l){let e=this.keyMap.get(l);var t;return e&&(t=e.prevKey)!==null&&t!==void 0?t:null}getKeyAfter(l){let e=this.keyMap.get(l);var t;return e&&(t=e.nextKey)!==null&&t!==void 0?t:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(l){var e;return(e=this.keyMap.get(l))!==null&&e!==void 0?e:null}at(l){const e=[...this.getKeys()];return this.getItem(e[l])}getChildren(l){let e=this.keyMap.get(l);return(e==null?void 0:e.childNodes)||[]}constructor(l){this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=l;let e=i=>{if(this.keyMap.set(i.key,i),i.childNodes&&i.type==="section")for(let o of i.childNodes)e(o)};for(let i of l)e(i);let t=null,d=0;for(let[i,o]of this.keyMap)t?(t.nextKey=i,o.prevKey=t.key):(this.firstKey=i,o.prevKey=void 0),o.type==="item"&&(o.index=d++),t=o,t.nextKey=void 0;var a;this.lastKey=(a=t==null?void 0:t.key)!==null&&a!==void 0?a:null}}function w(n){let{filter:l,layoutDelegate:e}=n,t=m(n),d=v.useMemo(()=>n.disabledKeys?new Set(n.disabledKeys):new Set,[n.disabledKeys]),a=v.useCallback(u=>l?new k(l(u)):new k(u),[l]),i=v.useMemo(()=>({suppressTextValueWarning:n.suppressTextValueWarning}),[n.suppressTextValueWarning]),o=p(n,a,i),y=v.useMemo(()=>new x(o,t,{layoutDelegate:e}),[o,t,e]);return M(o,y),{collection:o,disabledKeys:d,selectionManager:y}}function T(n,l){let e=v.useMemo(()=>l?n.collection.UNSTABLE_filter(l):n.collection,[n.collection,l]),t=n.selectionManager.withCollection(e);return M(e,t),{collection:e,selectionManager:t,disabledKeys:n.disabledKeys}}function M(n,l){const e=v.useRef(null);v.useEffect(()=>{if(l.focusedKey!=null&&!n.getItem(l.focusedKey)&&e.current){const s=e.current.getItem(l.focusedKey),K=[...e.current.getKeys()].map(b=>{const r=e.current.getItem(b);return(r==null?void 0:r.type)==="item"?r:null}).filter(b=>b!==null),c=[...n.getKeys()].map(b=>{const r=n.getItem(b);return(r==null?void 0:r.type)==="item"?r:null}).filter(b=>b!==null);var t,d;const h=((t=K==null?void 0:K.length)!==null&&t!==void 0?t:0)-((d=c==null?void 0:c.length)!==null&&d!==void 0?d:0);var a,i,o;let f=Math.min(h>1?Math.max(((a=s==null?void 0:s.index)!==null&&a!==void 0?a:0)-h+1,0):(i=s==null?void 0:s.index)!==null&&i!==void 0?i:0,((o=c==null?void 0:c.length)!==null&&o!==void 0?o:0)-1),g=null,$=!1;for(;f>=0;){if(!l.isDisabled(c[f].key)){g=c[f];break}if(f<c.length-1&&!$)f++;else{$=!0;var y,u;f>((y=s==null?void 0:s.index)!==null&&y!==void 0?y:0)&&(f=(u=s==null?void 0:s.index)!==null&&u!==void 0?u:0),f--}}l.setFocusedKey(g?g.key:null)}e.current=n},[n,l])}function F(n){var l;let[e,t]=S(n.selectedKey,(l=n.defaultSelectedKey)!==null&&l!==void 0?l:null,n.onSelectionChange),d=v.useMemo(()=>e!=null?[e]:[],[e]),{collection:a,disabledKeys:i,selectionManager:o}=w({...n,selectionMode:"single",disallowEmptySelection:!0,allowDuplicateSelectionEvents:!0,selectedKeys:d,onSelectionChange:u=>{if(u==="all")return;var s;let K=(s=u.values().next().value)!==null&&s!==void 0?s:null;K===e&&n.onSelectionChange&&n.onSelectionChange(K),t(K)}}),y=e!=null?a.getItem(e):null;return{collection:a,disabledKeys:i,selectionManager:o,selectedKey:e,setSelectedKey:t,selectedItem:y}}export{w as $,T as a,F as b,k as c};
