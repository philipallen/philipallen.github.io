import{a as D,e as F,r as M,s as W,d as y,i as G,f as A,c as H,t as I,u as R,m as j,v as K}from"./focusSafely-B-zcuC90.js";import{k as O,$ as _,d as L}from"./utils-BPOuYIA2.js";import{r as c,e as T}from"./index-CcKhGcwW.js";function U(){let e=c.useRef(new Map),t=c.useCallback((r,a,u,o)=>{let s=o!=null&&o.once?(...d)=>{e.current.delete(u),u(...d)}:u;e.current.set(u,{type:a,eventTarget:r,fn:s,options:o}),r.addEventListener(a,s,o)},[]),n=c.useCallback((r,a,u,o)=>{var s;let d=((s=e.current.get(u))===null||s===void 0?void 0:s.fn)||u;r.removeEventListener(a,d,o),e.current.delete(u)},[]),i=c.useCallback(()=>{e.current.forEach((r,a)=>{n(r.eventTarget,r.type,a,r.options)})},[n]);return c.useEffect(()=>i,[i]),{addGlobalListener:t,removeGlobalListener:n,removeAllGlobalListeners:i}}function Y(e,t){O(()=>{if(e&&e.ref&&t)return e.ref.current=t.current,()=>{e.ref&&(e.ref.current=null)}})}let m="default",S="",E=new WeakMap;function te(e){if(D()){if(m==="default"){const t=F(e);S=t.documentElement.style.webkitUserSelect,t.documentElement.style.webkitUserSelect="none"}m="disabled"}else if(e instanceof HTMLElement||e instanceof SVGElement){let t="userSelect"in e.style?"userSelect":"webkitUserSelect";E.set(e,e.style[t]),e.style[t]="none"}}function re(e){if(D()){if(m!=="disabled")return;m="restoring",setTimeout(()=>{M(()=>{if(m==="restoring"){const t=F(e);t.documentElement.style.webkitUserSelect==="none"&&(t.documentElement.style.webkitUserSelect=S||""),S="",m="default"}})},300)}else if((e instanceof HTMLElement||e instanceof SVGElement)&&e&&E.has(e)){let t=E.get(e),n="userSelect"in e.style?"userSelect":"webkitUserSelect";e.style[n]==="none"&&(e.style[n]=t),e.getAttribute("style")===""&&e.removeAttribute("style"),E.delete(e)}}function V(e){let{isDisabled:t,onFocus:n,onBlur:i,onFocusChange:r}=e;const a=c.useCallback(s=>{if(s.target===s.currentTarget)return i&&i(s),r&&r(!1),!0},[i,r]),u=W(a),o=c.useCallback(s=>{const d=F(s.target),p=d?y(d):y();s.target===s.currentTarget&&p===G(s.nativeEvent)&&(n&&n(s),r&&r(!0),u(s))},[r,n,u]);return{focusProps:{onFocus:!t&&(n||r||i)?o:void 0,onBlur:!t&&(i||r)?a:void 0}}}function k(e){if(!e)return;let t=!0;return n=>{let i={...n,preventDefault(){n.preventDefault()},isDefaultPrevented(){return n.isDefaultPrevented()},stopPropagation(){t=!0},continuePropagation(){t=!1},isPropagationStopped(){return t}};e(i),t&&n.stopPropagation()}}function q(e){return{keyboardProps:e.isDisabled?{}:{onKeyDown:k(e.onKeyDown),onKeyUp:k(e.onKeyUp)}}}let B=T.createContext(null);function z(e){let t=c.useContext(B)||{};Y(t,e);let{ref:n,...i}=t;return i}const ne=T.forwardRef(function(t,n){let{children:i,...r}=t,a=_(n),u={...r,ref:a};return T.createElement(B.Provider,{value:u},i)});function oe(e,t){let{focusProps:n}=V(e),{keyboardProps:i}=q(e),r=L(n,i),a=z(t),u=e.isDisabled?{}:a,o=c.useRef(e.autoFocus);c.useEffect(()=>{o.current&&t.current&&A(t.current),o.current=!1},[t]);let s=e.excludeFromTabOrder?-1:0;return e.isDisabled&&(s=void 0),{focusableProps:L({...r,tabIndex:s},u)}}function J(e){let{isDisabled:t,onBlurWithin:n,onFocusWithin:i,onFocusWithinChange:r}=e,a=c.useRef({isFocusWithin:!1}),{addGlobalListener:u,removeAllGlobalListeners:o}=U(),s=c.useCallback(l=>{l.currentTarget.contains(l.target)&&a.current.isFocusWithin&&!l.currentTarget.contains(l.relatedTarget)&&(a.current.isFocusWithin=!1,o(),n&&n(l),r&&r(!1))},[n,r,a,o]),d=W(s),p=c.useCallback(l=>{if(!l.currentTarget.contains(l.target))return;const v=F(l.target),b=y(v);if(!a.current.isFocusWithin&&b===G(l.nativeEvent)){i&&i(l),r&&r(!0),a.current.isFocusWithin=!0,d(l);let h=l.currentTarget;u(v,"focus",f=>{if(a.current.isFocusWithin&&!H(h,f.target)){let $=new v.defaultView.FocusEvent("blur",{relatedTarget:f.target});I($,h);let g=R($);s(g)}},{capture:!0})}},[i,r,d,u,s]);return t?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:p,onBlur:s}}}let C=!1,x=0;function N(){C=!0,setTimeout(()=>{C=!1},50)}function w(e){e.pointerType==="touch"&&N()}function Q(){if(!(typeof document>"u"))return typeof PointerEvent<"u"&&document.addEventListener("pointerup",w),x++,()=>{x--,!(x>0)&&typeof PointerEvent<"u"&&document.removeEventListener("pointerup",w)}}function se(e){let{onHoverStart:t,onHoverChange:n,onHoverEnd:i,isDisabled:r}=e,[a,u]=c.useState(!1),o=c.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;c.useEffect(Q,[]);let{addGlobalListener:s,removeAllGlobalListeners:d}=U(),{hoverProps:p,triggerHoverEnd:l}=c.useMemo(()=>{let v=(f,$)=>{if(o.pointerType=$,r||$==="touch"||o.isHovered||!f.currentTarget.contains(f.target))return;o.isHovered=!0;let g=f.currentTarget;o.target=g,s(F(f.target),"pointerover",P=>{o.isHovered&&o.target&&!H(o.target,P.target)&&b(P,P.pointerType)},{capture:!0}),t&&t({type:"hoverstart",target:g,pointerType:$}),n&&n(!0),u(!0)},b=(f,$)=>{let g=o.target;o.pointerType="",o.target=null,!($==="touch"||!o.isHovered||!g)&&(o.isHovered=!1,d(),i&&i({type:"hoverend",target:g,pointerType:$}),n&&n(!1),u(!1))},h={};return typeof PointerEvent<"u"&&(h.onPointerEnter=f=>{C&&f.pointerType==="mouse"||v(f,f.pointerType)},h.onPointerLeave=f=>{!r&&f.currentTarget.contains(f.target)&&b(f,f.pointerType)}),{hoverProps:h,triggerHoverEnd:b}},[t,n,i,r,o,s,d]);return c.useEffect(()=>{r&&l({currentTarget:o.target},o.pointerType)},[r]),{hoverProps:p,isHovered:a}}function ie(e={}){let{autoFocus:t=!1,isTextInput:n,within:i}=e,r=c.useRef({isFocused:!1,isFocusVisible:t||j()}),[a,u]=c.useState(!1),[o,s]=c.useState(()=>r.current.isFocused&&r.current.isFocusVisible),d=c.useCallback(()=>s(r.current.isFocused&&r.current.isFocusVisible),[]),p=c.useCallback(b=>{r.current.isFocused=b,u(b),d()},[d]);K(b=>{r.current.isFocusVisible=b,d()},[],{isTextInput:n});let{focusProps:l}=V({isDisabled:i,onFocusChange:p}),{focusWithinProps:v}=J({isDisabled:!i,onFocusWithinChange:p});return{isFocused:a,isFocusVisible:o,focusProps:i?v:l}}export{se as $,ie as a,J as b,oe as c,ne as d,U as e,re as f,te as g,q as h,Y as i,B as j,V as k};
